---
title: 快速开始
description: 5分钟内完成driver-box的安装和设备接入配置
sidebar:
  order: 1
---

import { Tabs, TabItem } from '@astrojs/starlight/components';
import { Aside } from '@astrojs/starlight/components';

# 快速开始

欢迎使用 driver-box！这是一款轻量级、配置化的物联网边缘平台。本指南将帮助您在5分钟内完成安装和第一个设备的接入。

## 工作流程概述

driver-box 的核心工作流程如下：

```mermaid
flowchart LR
    A[安装driver-box] --> B[配置设备接入]
    B --> C[启动服务]
    C --> D[验证数据收集]
    D --> E[配置数据导出]
```

<Aside type="note" title="适用场景">
  本指南适用于初次使用 driver-box 的用户，帮助您快速搭建开发环境并接入第一个物联网设备。
</Aside>

## 准备工作

在开始之前，请确保您的环境满足以下要求：

### 环境要求
- **Go 1.18+**：编译和运行driver-box
- **Git**：下载源码
- **SQLite3**：数据存储（通常系统已预装）

### 系统要求
- **最低配置**：128MB RAM
- **推荐配置**：256MB RAM以上
- **支持平台**：Linux、Windows、macOS

### 网络要求
- **设备通信**：Modbus、MQTT等协议端口
- **HTTP API**：默认8081端口
- **数据导出**：根据导出配置的端口

## 步骤1：获取driver-box

```bash
# 1. 获取源码
# 方式一：从本地项目目录（推荐）
cd /path/to/your/driver-box/project

# 方式二：从Git仓库（如果需要）
# git clone https://github.com/iBUILDING-X/driver-box.git
# cd driver-box

# 2. 下载依赖
go mod tidy
go mod vendor

# 3. 编译
go build -o driver-box main.go

# 4. 运行
./driver-box
```

<Aside type="tip" title="验证安装">
运行成功后，您将在控制台看到：
```text
start driver-box success.
```
</Aside>

<Aside type="caution" title="权限要求">
  在Linux/macOS上，如果遇到权限问题，请使用 `sudo ./driver-box` 或调整文件权限。
</Aside>

## 步骤2：设备接入配置

driver-box采用JSON配置的方式接入设备。下面以一个Modbus温湿度传感器为例：

### 创建配置目录

```bash
mkdir -p res/driver/modbus
```

### 编写配置

<Tabs>
	<TabItem label="res/driver/modbus/config.json" icon="seti:json">
		```json
		{
			"deviceModels": [
				{
					"name": "温湿度传感器",
					"description": "Modbus温湿度传感器",
					"devicePoints": [
						{
							"name": "temperature",
							"description": "温度",
							"valueType": "float",
							"readWrite": "R",
							"primaryTable": "HOLDING_REGISTER",
							"startAddress": "40001",
							"rawType": "uint16",
							"scale": 0.1,
							"unit": "℃"
						},
						{
							"name": "humidity",
							"description": "湿度",
							"valueType": "float",
							"readWrite": "R",
							"primaryTable": "HOLDING_REGISTER",
							"startAddress": "40002",
							"rawType": "uint16",
							"scale": 0.1,
							"unit": "%"
						}
					],
					"devices": [
						{
							"id": "sensor-001",
							"description": "会议室温湿度传感器",
							"connectionKey": "modbus-tcp-01",
							"ttl": "30s"
						}
					]
				}
			],
			"connections": {
				"modbus-tcp-01": {
					"host": "192.168.1.100",
					"port": 502,
					"mode": "tcp",
					"timeout": 5000,
					"slaveId": 1
				}
			},
			"protocolName": "modbus"
		}
		```
	</TabItem>
	<TabItem label="目录结构" icon="seti:folder">
		```
		res/
		└── driver/
		    └── modbus/
		        └── config.json
		```
	</TabItem>
</Tabs>

<Aside type="tip" title="配置验证">
  创建配置文件后，建议先使用JSON验证工具检查语法正确性。您也可以参考 `res/library/model/` 目录下的设备模型示例。
</Aside>

## 步骤3：验证接入效果

### 查看设备影子

启动driver-box后，打开浏览器访问：http://localhost:8081/api/v1/shadow/all

```json
{
	"success": true,
	"errorCode": 200,
	"data": [
		{
			"id": "sensor-001",
			"points": [
				{
					"name": "temperature",
					"value": 25.5,
					"updated_at": "2024-01-22 15:30:00"
				},
				{
					"name": "humidity",
					"value": 65.2,
					"updated_at": "2024-01-22 15:30:00"
				}
			],
			"online": true,
			"ttl": "30s"
		}
	]
}
```

### 通过API控制设备

<Tabs>
	<TabItem label="读取数据" icon="right-arrow">
		```bash
		curl http://localhost:8081/api/v1/device/readPoint?id=sensor-001&point=temperature
		```
	</TabItem>
	<TabItem label="写入数据" icon="pencil">
		```bash
		curl "http://localhost:8081/api/v1/device/writePoint?id=device-001&point=switch&value=1"
		```
	</TabItem>
</Tabs>

## 下一步

🎉 恭喜！您已经成功完成了driver-box的安装和第一个设备的接入。

### 推荐下一步学习：
- [**设备配置指南**](/guides/device-config/) - 详细了解设备配置参数和格式
- [**架构概述**](/concepts/architecture/) - 深入了解driver-box核心架构
- [**设备影子**](/concepts/device-shadow/) - 掌握设备数据管理机制
- [**配置化接入**](/concepts/configuration-driven/) - 学习无代码设备接入方式
- [**插件机制**](/concepts/plugin-system/) - 扩展更多协议支持
- [**导出机制**](/concepts/export-system/) - 配置数据导出和系统集成
- [**设备模型库**](/library/models/) - 丰富的预置设备模型
- [**开发者指南**](/developer/setup/) - 二次开发环境搭建

### 常见问题

#### 编译失败
**问题**：`go build` 命令执行失败
**解决方案**：
- 确认Go版本为1.18或更高：`go version`
- 检查网络连接，确保能下载依赖包
- 在企业网络环境下，可能需要配置Go代理：`go env -w GOPROXY=https://goproxy.cn,direct`

#### 设备无法连接
**问题**：日志显示连接超时或失败
**解决方案**：
- 检查设备IP地址和端口是否正确
- 确认防火墙未阻止相应端口
- 使用 `telnet <host> <port>` 测试网络连通性
- 检查Modbus从站ID是否匹配设备配置

#### 数据不更新
**问题**：设备影子中数据始终不变
**解决方案**：
- 验证点位地址（address）是否正确
- 检查数据类型（valueType）和原始类型（rawType）配置
- 确认缩放因子（scale）设置正确
- 查看driver-box日志中的详细错误信息

#### API调用失败
**问题**：HTTP请求返回错误
**解决方案**：
- 确认driver-box服务正在运行：`ps aux | grep driver-box`
- 检查端口8081是否被占用：`netstat -tlnp | grep 8081`
- 验证API路径和参数格式是否正确
- 检查设备ID是否存在于设备影子中

#### 配置语法错误
**问题**：服务启动失败，提示JSON解析错误
**解决方案**：
- 使用在线JSON验证工具检查配置文件
- 确认所有必需字段都已填写
- 检查引号、逗号和括号是否配对
- 参考 `res/library/model/` 中的示例文件

<Aside type="danger" title="重要提醒">
  如果问题无法解决，请查看控制台日志的详细错误信息，或参考项目中的文档和示例代码。
</Aside>